#! /usr/bin/env node

const { program } = require("commander");
const package = require("../package");
const fs = require('fs');

program.version(package.version);  // Version command
program.option("--init", "Initialize project")  // Initialize project
program.option("--server", "Start server")  // Starts server
program.option("-P, --port <port>", "Port of the server", 8000)  // Choose port of the server, standard = 8000
program.usage('[command] [options]')
program.parse();

const options = program.opts();

if (options.init) {
    require('child_process').execSync('npm i react react-dom @notverywellc/dev-server@latest @notverywellc/templates@latest', { stdio: 'inherit' });
    const path = require('path');
    const packagepath = path.resolve('package.json');
    const package = require(packagepath);

    package.scripts = package.scripts || {};
    package.scripts.start = "npx notverywellc-cli --server";
    package.scripts.cli_help = "npx notverywellc-cli --help";
    package.scripts.new_version = "npm publish --access public";
    package.scripts.new_cli = "npm i @notverywellc/cli@latest";
    package.scripts.patch = "npm version patch";
    package.scripts.cli_init = "npx notverywellc-cli --init";

    fs.writeFileSync(packagepath, JSON.stringify(package, null, 4))
}

if (options.server) {
    const startServer = require("@notverywellc/dev-server")
    startServer({port: options.port})
}
